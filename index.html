<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Designing Visualization Widgets for Tangible Data Exploration</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>

  <style>
    :root {
      --bg:            #f2f0eb;
      --elevated:      #ffffff;
      --txt-primary:   #3c352e;
      --txt-secondary: #867c6d;
      --accent:        #d17a5e;
      --shadow-dark:   rgba(180, 170, 150, 0.5); 
      --shadow-light:  rgba(255, 255, 255, 0.9);  
      --radius-lg:     14px;
      --radius-md:     10px;
      --transition-fast: 0.25s ease;
    }

    * { box-sizing: border-box; }
    body {
      font-family: 'JetBrains Mono', monospace;
      background: var(--bg);
      margin: 0;
      padding: 0;
      color: var(--txt-primary);
      overflow-x: hidden;
    }

    a { color: var(--accent); text-decoration: underline; }

    .neu-flat {
      background: var(--elevated);
      border-radius: var(--radius-md);
      box-shadow: 6px 6px 12px var(--shadow-dark),
                  -6px -6px 12px var(--shadow-light);
      transition: box-shadow var(--transition-fast), transform var(--transition-fast);
    }

    .neu-inset {
      background: var(--elevated);
      border-radius: var(--radius-md);
      box-shadow: inset 4px 4px 6px var(--shadow-dark),
                  inset -4px -4px 6px var(--shadow-light);
    }

    .neu-select-default {
      background: var(--elevated);
      border-radius: var(--radius-md);
      box-shadow: 4px 4px 10px var(--shadow-dark),
                  -4px -4px 10px var(--shadow-light);
    }

    .neu-flat:hover { transform: translateY(-2px); }
    .neu-flat:active {
      box-shadow: inset 3px 3px 6px var(--shadow-dark),
                  inset -3px -3px 6px var(--shadow-light);
      transform: translateY(2px);
    }

    .pressed {
      box-shadow: inset 3px 3px 6px var(--shadow-dark),
                  inset -3px -3px 6px var(--shadow-light) !important;
      transform: translateY(2px) !important;
    }
    .pressed:hover { transform: translateY(2px) !important; }

    .static { cursor: default; }
    .static.neu-flat:hover,
    .static.neu-flat:active {
      transform: none;
      box-shadow: 9px 9px 16px var(--shadow-dark),
                  -9px -9px 16px var(--shadow-light);
    }

    .header-container {
      position: fixed;
      top: 0; left: 0; width: 100%;
      background: var(--bg);
      z-index: 9999;
      padding-bottom: 12px;
      box-shadow: 0 6px 14px rgba(0,0,0,.04);
    }
    .header { text-align: center; padding: 18px 10px 12px; }
    .header h1 { font-size: 1.8rem; font-weight: 700; margin: 0; }
    .authors { font-style: italic; color: var(--txt-secondary); margin: 4px 0 0; }

    .navbar {
      display: flex; justify-content: center; flex-wrap: wrap;
      gap: 12px; margin-top: 14px;
    }
    .navbar button {
      display: flex; align-items: center; gap: 8px;
      padding: 10px 18px; font-size: 1rem; font-weight: bold;
      border: none; color: var(--txt-primary);
      background: var(--elevated); border-radius: var(--radius-lg);
      cursor: pointer;
      box-shadow: 6px 6px 12px var(--shadow-dark),
                  -6px -6px 12px var(--shadow-light);
      transition: var(--transition-fast);
    }
    .icon-placeholder { width: 18px; text-align: center; }

    .teaser {
      background: var(--elevated);
      border-radius: var(--radius-lg);
      box-shadow: 9px 9px 16px var(--shadow-dark),
                  -9px -9px 16px var(--shadow-light);
      padding: 16px;
      width: 65%;           
      max-width: 65%;
      height: auto; margin: 0 auto 20px; display: block;
    }

    .content-wrapper {
      width: 100%;
    }
    .layout-outer {
      display: flex; flex-wrap: wrap; justify-content: space-between;
      width: 95%; margin: 0 auto;
    }
    .left-gap, .middle-gap, .right-gap { flex: 1 1 5%; max-width: 5%; }

    .results-table-container { flex: 1 1 65%; display: flex; flex-direction: column; gap: 20px; }
    .card {
      background: var(--elevated);
      border-radius: var(--radius-lg);
      box-shadow: 9px 9px 16px var(--shadow-dark),
                  -9px -9px 16px var(--shadow-light);
      padding: 16px;
      display: flex; align-items: center; gap: 5%;
      height: auto; 
      overflow: hidden;
      position: relative;
      transition: transform 0.35s ease, box-shadow 0.35s ease;
    }
    .card-toggle-indicator {
      position: absolute;
      bottom: 10px;
      right: 16px;
      font-size: 1.1rem;
      color: var(--txt-secondary);
      pointer-events: none;
    }
    .card:hover {
      transform: translateY(-6px);
      box-shadow: 6px 6px 12px var(--shadow-dark),
                  -6px -6px 12px var(--shadow-light);
    }
    .card-index { font-size: 1.1rem; font-weight: bold; color: #a39582; margin-right: 10px; flex-shrink: 0; width: 20px; }
    .card img { width: 20%; height: auto; max-height: 100%; object-fit: contain;
                flex-shrink: 0; border-radius: var(--radius-md);
                box-shadow: 3px 3px 6px var(--shadow-dark),
                            -3px -3px 6px var(--shadow-light); }
    .card-content {
      width: 75%;
    }

    .card-text {
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 4; 
      -webkit-box-orient: vertical;
      text-overflow: ellipsis;
    }

    .results-table-container.exploration-active .card.expanded .card-text {
      overflow: visible;
      display: block;
      -webkit-line-clamp: none;
    }
    .card-title   { font-weight: 700; font-size: 1rem; margin-bottom: 6px; text-decoration: underline; color: var(--txt-primary); }
    .card-authors { font-size: 0.85rem; color: var(--txt-secondary); margin-bottom: 6px; }

    .results-table-container.exploration-active .card img {
      border-radius: 0;
      box-shadow: none;
      background: transparent;
    }

    .results-table-container.exploration-active .card {
      height: 150px; 
      transition: height 0.3s ease;
    }

    .results-table-container.exploration-active .card.expanded {
      height: auto; 
    }

    .results-table-container.exploration-active .card.expanded .card-content {
      overflow: visible;
      display: block;
      -webkit-line-clamp: none;
    }

    .results-table-container.exploration-active .card.expanded .card-icons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .card-labels {
      margin-top: 8px;
      font-size: 0.85rem;
      color: var(--txt-secondary);
    }

    .card-content {
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 4; 
      -webkit-box-orient: vertical;
      text-overflow: ellipsis;
    }

    .filter-bar {
      flex: 1 1 20%; background: var(--elevated);
      border-radius: var(--radius-lg);
      padding: 22px;
      box-shadow: 9px 9px 16px var(--shadow-dark),
                  -9px -9px 16px var(--shadow-light);
      height: fit-content; min-width: 200px;
    }

    .filter-bar.sticky {
      position: sticky;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--txt-secondary) transparent;
    }

    .filter-bar.sticky::-webkit-scrollbar {
      width: 6px;
    }

    .filter-bar.sticky::-webkit-scrollbar-thumb {
      background-color: var(--txt-secondary);
      border-radius: 3px;
    }
    .filter-bar h3 { margin-top: 0; text-align:center; }

    .filter-section { margin-bottom: 26px; padding-bottom: 16px; border-bottom: 1px solid #e8e3dc; }
    .filter-section h4 { margin: 0 0 14px; font-weight: bold; }

    .filter-item { display:flex; flex-direction:column; margin-bottom: 14px; }
    .filter-item label { font-size: .9rem; margin-bottom: 4px; }

    .title-reset-container { display: flex; align-items: center; gap: 8px; }

    .filter-select,
    .paper-title-input {
      width: 100%; padding: 8px 10px;
      font-family: 'JetBrains Mono', monospace; border: none;
      background: var(--elevated); border-radius: var(--radius-md);
      box-shadow: inset 4px 4px 8px var(--shadow-dark),
                  inset -4px -4px 8px var(--shadow-light);
      appearance: none; outline: none;
    }
    .filter-select:focus,
    .paper-title-input:focus {
      box-shadow: inset 3px 3px 6px var(--shadow-dark),
                  inset -3px -3px 6px var(--shadow-light);
    }

    .reset-btn {
      padding: 8px 14px; font-weight: bold; border: none;
      color: var(--txt-primary); background: var(--elevated);
      border-radius: var(--radius-md); cursor: pointer;
      box-shadow: 6px 6px 12px var(--shadow-dark),
                  -6px -6px 12px var(--shadow-light);
      transition: var(--transition-fast);
    }
    .reset-btn:hover  { transform: translateY(-2px); }
    .reset-btn:active {
      box-shadow: inset 3px 3px 6px var(--shadow-dark),
                  inset -3px -3px 6px var(--shadow-light);
      transform: translateY(2px);
    }

    .text-content {
      width: 80%; margin: 0 auto;
      font-size: 0.95rem; line-height: 1.6; text-align: justify;
      background: var(--elevated); border-radius: var(--radius-lg);
      padding: 10px 10px;
      box-shadow: 9px 9px 16px var(--shadow-dark),
                  -9px -9px 16px var(--shadow-light);
    }

    .contact-card {
      width: auto;              
      max-width: 800px;         
      text-align: left;         
      margin: 20px auto;        
      padding: 20px 20px;     
      display: inline-block;   
    }

    .contact-card .contact-row {
      display: flex;            
      align-items: center;    
      margin-bottom: 12px;     
    }

    .contact-card .contact-name {
      width: 120px;              
      font-weight: bold;      
      margin-left: 6px;          
    }

    .contact-card .orcid-link {
      margin: 0 10px;           
    }

    .contact-card .contact-email {
      flex-grow: 1;             
      margin-right: 10px;      
      word-break: break-all;    
    }

    @media screen and (max-width: 800px) {
      .layout-outer { flex-direction: column; align-items: center; }
      .left-gap, .middle-gap, .right-gap { display: none; }
      .results-table-container, .filter-bar { width: 90% !important; }
      .text-content { width: 90%; }
    }

    @media screen and (max-width: 600px) {
      .header h1 {
        font-size: 1.2rem;
      }

      .navbar {
        flex-direction: column;
        gap: 8px;
      }

      .navbar button {
        font-size: 0.9rem;
        padding: 8px 12px;
      }

      .teaser {
        width: 90%;
        max-width: 90%;
      }

      .layout-outer {
        flex-direction: column;
        align-items: center;
        width: 100%;
        display: flex;
      }

      .results-table-container,
      .filter-bar {
        width: 95% !important;
      }

      .filter-bar {
        padding: 14px;
        order: -1; 
        position: static !important; 
        height: auto !important;   
        top: auto !important;       
        overflow: visible !important; 
      }

      .filter-bar h3,
      .filter-bar h4 {
        font-size: 1rem;
        text-align: left;
      }

      .filter-item label,
      .filter-select,
      .paper-title-input {
        font-size: 0.9rem;
      }

      .reset-btn {
        padding: 6px 10px;
        font-size: 0.9rem;
      }

      .card {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .card img {
        width: 100%;
        max-height: none;
        object-fit: cover;
      }

      .card-content {
        width: 100%;
      }

      .card-index {
        display: none;
      }

      .text-content {
        width: 90%;
        font-size: 0.9rem;
      }

      .card-labels p {
        font-size: 0.9rem;
      }
    }

    .authors a {
      color: var(--txt-secondary);
      text-decoration: underline;
    }

    .icon-link {
      text-decoration: none;
    }

  </style>
</head>

<body>
  <div class="header-container">
    <div class="header">
      <h1>Designing Visualization Widgets for Tangible Data Exploration:</h1>
      <h1>A Systematic Review</h1>
      <p class="authors">
        <a href="https://orcid.org/0009-0003-8069-0338" target="_blank">Haonan Yao<span style="margin-left:6px;"></span><img src="Resources/Icons/orcid.svg" alt="ORCID" style="height:1em; vertical-align:middle;"></a>, 
        <a href="https://orcid.org/0000-0003-0546-5926" target="_blank">Lingyun Yu<span style="margin-left:6px;"></span><img src="Resources/Icons/orcid.svg" alt="ORCID" style="height:1em; vertical-align:middle;"></a>, 
        <a href="https://orcid.org/0000-0002-4208-5140" target="_blank">Lijie Yao<span style="margin-left:6px;"></span><img src="Resources/Icons/orcid.svg" alt="ORCID" style="height:1em; vertical-align:middle;"></a>
      </p>
      <p class="authors" style="margin-top: 2px; font-style: normal;">
        Department of Computing, School of Advanced Technology, Xi'an Jiaotong-Liverpool University
      </p>
    </div>

    <img src="Resources/Teaser.jpg" class="teaser neu-flat static" alt="Teaser">

    <div class="navbar">
      <button class="neu-flat" data-tab="home"><span class="icon-placeholder">🏠</span>Home Page</button>
      <button class="neu-flat" data-tab="explore"><span class="icon-placeholder">🔭</span>Exploration</button>
      <button class="neu-flat" data-link="https://example.com/paper"  ><span class="icon-placeholder">📄</span>Paper</button>
      <button class="neu-flat" data-link="https://osf.io/vjw5e/"       ><span class="icon-placeholder">📁</span>OSF</button>
      <button class="neu-flat" data-tab="contact"><span class="icon-placeholder">📧</span>Contact</button>
    </div>
  </div>

  <div class="content-wrapper">
    <div class="layout-outer" id="exploreSection">
      <div class="left-gap"></div>

      <div class="results-table-container" id="resultsContainer">
        <p>Loading...</p>
      </div>

      <div class="middle-gap"></div>

      <div class="filter-bar neu-flat static">
        <h3>Filter</h3>

        <div class="instance-count-container">
          <p>Number of instances:</p>
          <span id="instanceCount">0 / 0</span>
        </div>

        <div class="filter-section">
          <br>
          <h4>Search:</h4>
          <div class="title-reset-container">
            <input type="text" id="paperTitleSearch" placeholder="Search by keywords..." class="paper-title-input neu-inset">
            <button id="resetFilters" class="reset-btn">Reset</button>
          </div>
        </div>

        <div id="filterOptions"></div>
      </div>

      <div class="right-gap"></div>
    </div>

    <div id="textSection" style="display:none">
      <div class="text-content">
        <h3 class="card-title" style="font-size: 1rem; font-weight: bold; color: var(--txt-primary); margin-top: 0; text-decoration: none; font-family: Arial">Abstract</h3>
        <p>
          We present a systematic review on tasks, interactions, and visualization widgets in the context of tangible data exploration.
          Tangible widgets have been shown to reduce cognitive load, enable more natural interactions, and support the completion of complex data exploration tasks.
          Yet, the field lacks a structured understanding of how task types, interaction methods, and widget designs are coordinated, limiting the ability to identify recurring design patterns and opportunities for innovation.
          To address this gap, we conduct a systematic review to analyze existing work and characterize the current design of data exploration tasks, interactions, and tangible visualization widgets.
          We next reflect based on our findings and propose a research agenda to inform the development of a future widget design toolkit for tangible data exploration.
          Our systematic review and supplemental materials are available at <a href="https://osf.io/vjw5e/">osf.io/vjw5e/</a>.
        </p>
      </div>

      <div class="text-content" style="margin-top: 20px">
        <h3 class="card-title" style="font-size: 1rem; font-weight: bold; color: var(--txt-primary); margin-top: 0; text-decoration: none; font-family: Arial">Categorization</h3>
        <p>
          <img src="Resources/Icons/TaskEntity.jpg" style="width:24px; height:24px; margin-right:8px; vertical-align:middle;"><strong style="color: rgb(80,79,114);">Tasks</strong> describe in which environment the data exploration tasks have been conducted (<em>Task environment</em>), what the task content is (<em>Task content</em>), and in which representation the task entity has been perceived by users (<em>Task entity's representation</em>).<br>
          <img src="Resources/Icons/UserInteraction.jpg" style="width:24px; height:24px; margin-right:8px; vertical-align:middle;"><strong style="color: rgb(82,106,96);">User Interactions</strong> describe how users operate tangible entities to complete a data exploration task (<em>Manipulation method</em>), what interactions users perform (<em>Interaction type</em>), and where interactions take place (<em>Where the interaction happens</em>).<br>
          <img src="Resources/Icons/Widgets.jpg" style="width:24px; height:24px; margin-right:8px; vertical-align:middle;"><strong style="color: rgb(140,95,35);">Visualization Widgets</strong> refer to tangible entities that are used to accomplish data exploration tasks through specific interactions. Here we discuss how big a widget is (<em>Size</em>), how many widgets are used (<em>Quantity</em>), the shape in which the widget acts (<em>Functional shape</em>), and the material properties of the widget (<em>Material properties</em>).<br>
          <img src="Resources/Icons/RelativePosition.jpg" style="width:24px; height:24px; margin-right:8px; vertical-align:middle;"><strong style="color: rgb(156,75,75);">Relative Position</strong> indicates the <em>Accessible distance between user and task entity</em>, the <em>Accessible distance between user and visualization widget(s)</em>, and the <em>Spatial integration between task entity and visualization widget(s)</em>.
        </p>
      </div>
    </div>

    <div id="contactSection" style="display:none; margin: 0 auto; text-align: center;" class="text-content contact-card">
      <h3 class="card-title" style="font-size: 1rem; font-weight: bold; color: var(--txt-primary); margin-top: 0; text-decoration: none; font-family: Arial; text-align: left;">Contact</h3>

      <div class="contact-row">
        <span class="contact-name">Haonan Yao</span>
        <a class="icon-link orcid-link" href="https://orcid.org/0009-0003-8069-0338" target="_blank">
          <img src="Resources/Icons/orcid.svg" alt="ORCID" style="height:1em; vertical-align:middle;">
        </a>
        <span class="contact-email">haonanyao0622@gmail.com</span>
        <a class="icon-link email-link" href="#" onclick="sendMail('haonanyao0622@gmail.com')">📧</a>
      </div>

      <div class="contact-row">
        <span class="contact-name">Lingyun Yu</span>
        <a class="icon-link orcid-link" href="https://orcid.org/0000-0003-0546-5926" target="_blank">
          <img src="Resources/Icons/orcid.svg" alt="ORCID" style="height:1em; vertical-align:middle;">
        </a>
        <span class="contact-email">lingyun.yu@xjtlu.edu.cn</span>
        <a class="icon-link email-link" href="#" onclick="sendMail('lingyun.yu@xjtlu.edu.cn')">📧</a>
      </div>

      <div class="contact-row">
        <span class="contact-name">Lijie Yao</span>
        <a class="icon-link orcid-link" href="https://orcid.org/0000-0002-4208-5140" target="_blank">
          <img src="Resources/Icons/orcid.svg" alt="ORCID" style="height:1em; vertical-align:middle;">
        </a>
        <span class="contact-email">lijie.yao@xjtlu.edu.cn</span>
        <a class="icon-link email-link" href="#" onclick="sendMail('lijie.yao@xjtlu.edu.cn')">📧</a>
      </div>
    </div>

  </div>

  <script>
    let allData = [];
    let currentFilters = {};
    let paperTitleSearchText = '';
    let currentTab = 'Home Page';    

    const alwaysVisibleLabels = ['Functional Shape', 'Task Content', 'Interaction Type'];
    const allLabels = [
    'Task Environment', 'Task Content', "Task Entity's Representation",
    'Manipulation Method', 'Interaction Type', 'Where the Interaction Happens',
    'Size', 'Quantity', 'Physical Form', 'Functional Shape', 'Material Properties',
    'Accessible Distance between User and Visualization Widget(s)',
    'Accessible Distance between User and Task Entity',
    'Spatial Integration between Task Entity and Visualization Widget(s)'
    ];
    
    const groups = [
    { title: 'Tasks', labels: ['Task Environment', 'Task Content', "Task Entity's Representation"] },
    { title: 'User Interactions', labels: ['Manipulation Method', 'Interaction Type', 'Where the Interaction Happens'] },
    { title: 'Visualization Widgets', labels: ['Size', 'Quantity', 'Physical Form', 'Functional Shape', 'Material Properties'] },
    { title: 'Relative Position', labels: ['Accessible Distance between User and Visualization Widget(s)', 'Accessible Distance between User and Task Entity', 'Spatial Integration between Task Entity and Visualization Widget(s)'] }
    ];

    function addUnifiedClick(el, handler) {
      el.addEventListener('click',  e => handler(e, false));

      el.addEventListener('auxclick', e => {
        if (e.button === 1) {
          e.preventDefault();
          handler(e, true);
        }
      });
      el.addEventListener('mousedown', e => {
        if (e.button === 1) {
          e.preventDefault();
          handler(e, true);
        }
      });
    }

    const navButtons = document.querySelectorAll('.navbar button');

    function updateNavPressed() {
      navButtons.forEach(btn => {
        const tab = btn.dataset.tab;
        if ((tab === 'home' && currentTab === 'Home Page') ||
          (tab === 'explore' && currentTab === 'Exploration') ||
          (tab === 'contact' && currentTab === 'Contact')) {
        btn.classList.add('pressed');
      } else {
        btn.classList.remove('pressed');
      }
      });
    }

    navButtons.forEach(btn => {
      btn.addEventListener('mousedown', () => {
        navButtons.forEach(b => b.classList.remove('pressed'));
        btn.classList.add('pressed');
      });
      btn.addEventListener('mouseup',   updateNavPressed);
      btn.addEventListener('mouseleave',updateNavPressed);

      addUnifiedClick(btn, (e) => {
      if (btn.dataset.tab) {
        if (btn.dataset.tab === 'home') {
          currentTab = 'Home Page';
        } else if (btn.dataset.tab === 'explore') {
          currentTab = 'Exploration';
        } else if (btn.dataset.tab === 'contact') {
          currentTab = 'Contact';
        }
        switchTab(currentTab);
        updateNavPressed();
      } else if (btn.dataset.link) {
          window.open(btn.dataset.link, '_blank');
        }
      });
    });

    addUnifiedClick(document.getElementById('resetFilters'), () => resetAllFilters());

    function switchTab(tabName) {
      const explore = document.getElementById('exploreSection');
      const text    = document.getElementById('textSection');
      const contact = document.getElementById('contactSection');
      const filterBar = document.querySelector('.filter-bar');
      const resultsContainer = document.querySelector('.results-table-container');

      explore.style.display = 'none';
      text.style.display    = 'none';
      contact.style.display = 'none';
      filterBar.classList.remove('sticky');
      resultsContainer.classList.remove('exploration-active');

      if (tabName === 'Home Page') {
        text.style.display = 'block';
      } else if (tabName === 'Exploration') {
        explore.style.display = 'flex';
        document.querySelectorAll('.filter-select').forEach(select => toggleSelectStyle(select));
        filterBar.classList.add('sticky');
        updateFilterBarPosition();
        resultsContainer.classList.add('exploration-active');
      } else if (tabName === 'Contact') {
        contact.style.display = 'block';
      }

      updateContentOffset();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function createFilterOptions() {
      const container = document.getElementById('filterOptions');
      container.innerHTML = '';
      groups.forEach(group => {
        const sec = document.createElement('div');
        sec.className = 'filter-section';
    
        const title = document.createElement('h4');
        const icon = document.createElement('img');
        switch(group.title) {
          case 'Tasks':
            icon.src = 'Resources/Icons/TaskEntity.jpg';
            title.style.color = 'rgb(80,79,114)';
            break;
          case 'User Interactions':
            icon.src = 'Resources/Icons/UserInteraction.jpg';
            title.style.color = 'rgb(82,106,96)';
            break;
          case 'Visualization Widgets':
            icon.src = 'Resources/Icons/Widgets.jpg';
            title.style.color = 'rgb(140,95,35)';
            break;
          case 'Relative Position':
            icon.src = 'Resources/Icons/RelativePosition.jpg';
            title.style.color = 'rgb(156,75,75)';
            break;
        }
        icon.style.width = '24px';
        icon.style.height = '24px';
        icon.style.marginRight = '8px';
        icon.style.verticalAlign = 'middle';
        title.appendChild(icon);
        title.appendChild(document.createTextNode(group.title));
        sec.appendChild(title);

        group.labels.forEach(label => {
          const allValues   = [...new Set(allData.map(d => d[label]))].filter(Boolean).sort();
          const filtered    = applyCurrentFilterExcept(label);
          const counts      = Object.fromEntries(allValues.map(v => [v, 0]));
          filtered.forEach(d => { const v = d[label]; if (v) counts[v]++; });

          const item = document.createElement('div');
          item.className = 'filter-item';

          const lab = document.createElement('label');
          lab.textContent = label + ':';
          item.appendChild(lab);

          const select = document.createElement('select');
          select.className = 'filter-select';
          select.dataset.label = label;
          select.innerHTML = '<option value="">All</option>';
          allValues.forEach(v => {
            select.innerHTML += `<option value="${v}">${v} (${counts[v] || 0})</option>`;
          });

          select.value = currentFilters[label] || '';
          toggleSelectStyle(select);

          addUnifiedClick(select, () =>{});
          select.onchange = e => {
            currentFilters[label] = e.target.value;
            toggleSelectStyle(e.target);
            applyFilters();
          };

          item.appendChild(select);
          sec.appendChild(item);
        });
        container.appendChild(sec);
      });
    }

    function toggleSelectStyle(sel) {
      if (sel.value === '') {
        sel.classList.remove('neu-inset');
        sel.classList.add('neu-select-default');
        sel.style.boxShadow = '6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light)';
      } else {
        sel.classList.add('neu-inset');
        sel.classList.remove('neu-select-default');
        sel.style.boxShadow = 'inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light)';
      }
    }

    const applyCurrentFilterExcept = skip =>
      allData.filter(d =>
        Object.entries(currentFilters).every(([k, v]) => k === skip || !v || d[k] === v) &&
        (!paperTitleSearchText || matchesSearchText(d))
      );

    const matchesSearchText = d => {
      const allLabels = ['Paper Name', 'Authors'].concat(...groups.map(g => g.labels));
      return allLabels.some(l => d[l] && d[l].toLowerCase().includes(paperTitleSearchText.toLowerCase()));
    };

    function applyFilters() {
      const filtered = allData.filter(d =>
        Object.entries(currentFilters).every(([k, v]) => !v || d[k] === v) &&
        (!paperTitleSearchText || matchesSearchText(d))
      );
      renderResults(filtered);
      createFilterOptions();
    }

    function renderResults(data) {
      const container = document.getElementById('resultsContainer');
      container.innerHTML = '';
      document.getElementById('instanceCount').textContent = `${data.length} / ${allData.length}`;

      if (!data.length) {
        container.innerHTML = '<p>No results found.</p>';
        return;
      }

      data.forEach((item, idx) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.item = item;

        let mouseDownX = 0;
        let mouseDownY = 0;

        card.addEventListener('mousedown', e => {
          mouseDownX = e.clientX;
          mouseDownY = e.clientY;
        });

        addUnifiedClick(card, (e) => {
          if (e.target.closest('.card-title')) return;

          const moved = Math.abs(e.clientX - mouseDownX) > 3 || Math.abs(e.clientY - mouseDownY) > 3;
          if (moved) return;

          document.querySelectorAll('.card').forEach(c => {
            if (c !== card) {
              c.classList.remove('expanded');
              updateCardLabels(c, c.item);
            }
          });

          card.classList.toggle('expanded');
          updateCardLabels(card, card.item);
        });

        const index = document.createElement('div');
        index.className = 'card-index';
        index.textContent = idx + 1;
        card.appendChild(index);

        const img = document.createElement('img');
        img.src = `Resources/PaperImages/Instance${item.originalIndex + 1}.png`;
        img.alt = 'Figure';
        card.appendChild(img);

        const content = document.createElement('div');
        content.className = 'card-content';

        const fixedTitle = fixLatexChars(item['Paper Name'] || '');
        const fixedAuthors = fixLatexChars(item['Authors'] || '');

        content.innerHTML = `
          <div class="card-text">
            <a class="card-title" href="${item['Paper Link'] || '#'}" target="_blank">${fixedTitle}</a>
            <div class="card-authors">${fixedAuthors}</div>
          </div>
          <div class="card-labels"></div>`;

        card.appendChild(content);

        const toggleIndicator = document.createElement('div');
        toggleIndicator.className = 'card-toggle-indicator';
        toggleIndicator.textContent = '▼'; 
        card.appendChild(toggleIndicator);

        content.querySelector('.card-title').addEventListener('click', e => e.stopPropagation());

        updateCardLabels(card, item);

        container.appendChild(card);
      });
    }

    function updateCardLabels(card, item) {
      const isExpanded = card.classList.contains('expanded');
      const labelContainer = card.querySelector('.card-labels');
      labelContainer.innerHTML = '';

      if (isExpanded) {
        function lowerFirst(str) {
          return str.charAt(0).toLowerCase() + str.slice(1);
        }
        function getArticle(word) {
          const vowels = ['a', 'e', 'i', 'o', 'u'];
          const firstLetter = word.trim().charAt(0).toLowerCase();
          return vowels.includes(firstLetter) ? 'an' : 'a';
        }
        function toFileName(str) {
          return str.trim().toLowerCase().replace(/\//g, '_').replace(/[^a-z0-9 _-]/g, '') + '.jpg';
        }
        const rawA = item['Functional Shape'] || 'shape';
        const rawB = item['Task Content'] || 'task';
        const rawC = item['Interaction Type'] || 'interaction';
        const A = lowerFirst(rawA);
        const B = lowerFirst(rawB);
        const C = rawC.split('+').map(w => lowerFirst(w.trim())).join('+');
        const article = getArticle(A);
        const colorA = '#D08355';
        const colorB = '#A2A1CD';
        const colorC = '#A6C4B8';
        const iconStyle = 'width:1em; height:1em; vertical-align:middle; margin-right:4px; object-fit:cover;';
        const iconA = `<img src="Resources/Icons/${toFileName(rawA)}" style="${iconStyle}">`;
        const iconB = `<img src="Resources/Icons/${toFileName(rawB)}" style="${iconStyle}">`;
        const iconC = rawC.split('+').map(w =>
          `<img src="Resources/Icons/${toFileName(w)}" style="${iconStyle}">`
        ).join('');
        const summaryHTML = `Use ${article} ${iconA}<span style="color:${colorA}; font-weight:bold">${A}</span> for ` +
                            `${iconB}<span style="color:${colorB}; font-weight:bold">${B}</span> by ` +
                            `${iconC}<span style="color:${colorC}; font-weight:bold">${C}</span>.`;

        const summaryP = document.createElement('p');
        summaryP.innerHTML = summaryHTML;
        summaryP.style.margin = '4px 0';
        summaryP.addEventListener('click', (e) => {
          e.stopPropagation();
          const clickEvent = new MouseEvent('click', {
            bubbles: true,
            cancelable: true,
            view: window
          });
          card.dispatchEvent(clickEvent);
        });
        labelContainer.appendChild(summaryP);

        const labelColors = {
          'Task Environment': '#8264AA',
          'Task Content': '#A2A1CD',
          "Task Entity's Representation": '#6380A2',
          'Manipulation Method': '#98B86F',
          'Interaction Type': '#A6C4B8',
          'Where the Interaction Happens': '#669295',
          'Size': '#E1E14F',
          'Quantity': '#E5BF78',
          'Functional Shape': '#D08355',
          'Material Properties': '#B28474',
          'Accessible Distance between User and Task Entity': '#B86E9F',
          'Accessible Distance between User and Visualization Widget(s)': '#8D4C60',
          'Spatial Integration between Task Entity and Visualization Widget(s)': '#C77F80'
        };

        function getAlphaIndex(n) {
          let result = '';
          do {
            result = String.fromCharCode(97 + (n % 26)) + result;
            n = Math.floor(n / 26) - 1;
          } while (n >= 0);
          return result;
        }

        let labelIndex = 0;
        allLabels.filter(label => label !== 'Physical Form').forEach(label => {
          if (item[label]) {
            const prefix = `(${getAlphaIndex(labelIndex)})`;
            const p = document.createElement('p');
            p.innerHTML = `<span style="color: ${labelColors[label] || 'inherit'}; font-weight: bold">${prefix} ${label}:</span> ${item[label]}`;
            p.style.margin = '4px 0';
            labelContainer.appendChild(p);
            labelIndex++;
          }
        });

        const physicalForm = 'Physical Form';
        if (item[physicalForm]) {
          const prefix = `(${getAlphaIndex(labelIndex)})`;
          const p = document.createElement('p');
          p.innerHTML = `<span style="color: ${labelColors[physicalForm] || 'inherit'}; font-weight: bold">${prefix} ${physicalForm}:</span> ${item[physicalForm]}`;
          p.style.margin = '4px 0';
          labelContainer.appendChild(p);
        }
      } else {
          function lowerFirst(str) {
            return str.charAt(0).toLowerCase() + str.slice(1);
          }
          function getArticle(word) {
            const vowels = ['a', 'e', 'i', 'o', 'u'];
            const firstLetter = word.trim().charAt(0).toLowerCase();
            return vowels.includes(firstLetter) ? 'an' : 'a';
          }
          function toFileName(str) {
            return str
              .trim()
              .toLowerCase()
              .replace(/\//g, '_')
              .replace(/[^a-z0-9 _-]/g, '') + '.jpg';
          }

          const rawA = item['Functional Shape'] || 'shape';
          const rawB = item['Task Content'] || 'task';
          const rawC = item['Interaction Type'] || 'interaction';

          const A = lowerFirst(rawA);
          const B = lowerFirst(rawB);
          const C = rawC
            .split('+')
            .map(w => lowerFirst(w.trim()))
            .join('+');

          const article = getArticle(A);

          const colorA = '#D08355';
          const colorB = '#A2A1CD';
          const colorC = '#A6C4B8';

          const iconStyle = 'width:1em; height:1em; vertical-align:middle; margin-right:4px; object-fit:cover;';
          const iconA = `<img src="Resources/Icons/${toFileName(rawA)}" style="${iconStyle}">`;
          const iconB = `<img src="Resources/Icons/${toFileName(rawB)}" style="${iconStyle}">`;
          const iconC = rawC.split('+').map(w =>
            `<img src="Resources/Icons/${toFileName(w)}" style="${iconStyle}">`
          ).join('');

          const summaryHTML = `Use ${article} ${iconA}<span style="color:${colorA}; font-weight:bold">${A}</span> for ` +
                              `${iconB}<span style="color:${colorB}; font-weight:bold">${B}</span> by ` +
                              `${iconC}<span style="color:${colorC}; font-weight:bold">${C}</span>.`;

          const summaryP = document.createElement('p');
          summaryP.innerHTML = summaryHTML;
          summaryP.style.margin = '4px 0';
          summaryP.addEventListener('click', (e) => {
            e.stopPropagation();
            const clickEvent = new MouseEvent('click', {
              bubbles: true,
              cancelable: true,
              view: window
            });
            card.dispatchEvent(clickEvent);
          });
          labelContainer.appendChild(summaryP);
        }

        const indicator = card.querySelector('.card-toggle-indicator');
        if (indicator) {
          indicator.textContent = isExpanded ? '▲' : '▼';
        }
    }

    function fixLatexChars(str) {
      return str
        .replace(/\\'a/g, 'á').replace(/\\'A/g, 'Á')
        .replace(/\\'e/g, 'é').replace(/\\'E/g, 'É')
        .replace(/\\'i/g, 'í').replace(/\\'I/g, 'Í')
        .replace(/\\'o/g, 'ó').replace(/\\'O/g, 'Ó')
        .replace(/\\'u/g, 'ú').replace(/\\'U/g, 'Ú')
        .replace(/\\'y/g, 'ý').replace(/\\'Y/g, 'Ý')

        .replace(/\\`a/g, 'à').replace(/\\`A/g, 'À')
        .replace(/\\`e/g, 'è').replace(/\\`E/g, 'È')
        .replace(/\\`i/g, 'ì').replace(/\\`I/g, 'Ì')
        .replace(/\\`o/g, 'ò').replace(/\\`O/g, 'Ò')
        .replace(/\\`u/g, 'ù').replace(/\\`U/g, 'Ù')

        .replace(/\\\"a/g, 'ä').replace(/\\\"A/g, 'Ä')
        .replace(/\\\"e/g, 'ë').replace(/\\\"E/g, 'Ë')
        .replace(/\\\"i/g, 'ï').replace(/\\\"I/g, 'Ï')
        .replace(/\\\"o/g, 'ö').replace(/\\\"O/g, 'Ö')
        .replace(/\\\"u/g, 'ü').replace(/\\\"U/g, 'Ü')
        .replace(/\\\"y/g, 'ÿ').replace(/\\\"Y/g, 'Ÿ')

        .replace(/\\\^a/g, 'â').replace(/\\\^A/g, 'Â')
        .replace(/\\\^e/g, 'ê').replace(/\\\^E/g, 'Ê')
        .replace(/\\\^i/g, 'î').replace(/\\\^I/g, 'Î')
        .replace(/\\\^o/g, 'ô').replace(/\\\^O/g, 'Ô')
        .replace(/\\\^u/g, 'û').replace(/\\\^U/g, 'Û')

        .replace(/\\~a/g, 'ã').replace(/\\~A/g, 'Ã')
        .replace(/\\~o/g, 'õ').replace(/\\~O/g, 'Õ')
        .replace(/\\~n/g, 'ñ').replace(/\\~N/g, 'Ñ')

        .replace(/\\r\{a\}/g, 'å').replace(/\\r\{A\}/g, 'Å')

        .replace(/\\c\{c\}/g, 'ç').replace(/\\c\{C\}/g, 'Ç')

        .replace(/\\v\{c\}/g, 'č').replace(/\\v\{C\}/g, 'Č')
        .replace(/\\v\{s\}/g, 'š').replace(/\\v\{S\}/g, 'Š')
        .replace(/\\v\{z\}/g, 'ž').replace(/\\v\{Z\}/g, 'Ž')

        .replace(/\\H\{o\}/g, 'ő').replace(/\\H\{O\}/g, 'Ő')
        .replace(/\\H\{u\}/g, 'ű').replace(/\\H\{U\}/g, 'Ű')

        .replace(/\\u\{o\}/g, 'ŏ').replace(/\\u\{O\}/g, 'Ŏ')
        .replace(/\\u\{e\}/g, 'ĕ').replace(/\\u\{E\}/g, 'Ĕ')

        .replace(/\\\.{I}/g, 'İ').replace(/\\\.{i}/g, 'ı') 

        .replace(/\\ae/g, 'æ').replace(/\\AE/g, 'Æ')
        .replace(/\\oe/g, 'œ').replace(/\\OE/g, 'Œ')
        .replace(/\\ss/g, 'ß')

        .replace(/\\o/g, 'ø').replace(/\\O\{\}/g, 'Ø').replace(/\\O/g, 'Ø')
        .replace(/\\l/g, 'ł').replace(/\\L/g, 'Ł')

        .replace(/\\[a-zA-Z]+\{?[a-zA-Z]?\}?/g, '')
        .replace(/\\'/g, '').replace(/\\`/g, '')
        .replace(/\\\^/g, '').replace(/\\\"/g, '')
        .replace(/\\~/g, '').replace(/\\c/g, '')
        .replace(/\\v/g, '').replace(/\\H/g, '')
        .replace(/\\r/g, '').replace(/\\u/g, '')
        .replace(/\\\./g, '').replace(/\\=/g, '');
    }

    function fixLatexInData(data) {
      data.forEach((d, i) => {
        d.originalIndex = i;
        Object.keys(d).forEach(key => {
          if (typeof d[key] === 'string') {
            d[key] = fixLatexChars(d[key]);
          }
        });
      });
    }

    async function loadCSVData() {
      const resp = await fetch('Resources/metadata.csv');
      const buffer = await resp.arrayBuffer();
      const decoder = new TextDecoder('utf-8');
      let text = decoder.decode(buffer);
      text = text.replace(/^\ufeff/, ''); 
      const data = d3.csvParse(text);

      fixLatexInData(data); 

      allData = data;
      createFilterOptions();
      renderResults(allData);
    }

    function resetAllFilters() {
      currentFilters = {};
      paperTitleSearchText = '';
      document.getElementById('paperTitleSearch').value = '';
      renderResults(allData);
      createFilterOptions();
    }

    function updateContentOffset() {
      const header = document.querySelector('.header-container');
      const contentWrapper = document.querySelector('.content-wrapper');
      if (header && contentWrapper) {
        const offset = header.offsetHeight + 20; 
        contentWrapper.style.marginTop = offset + 'px';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadCSVData();

      document.getElementById('paperTitleSearch').oninput = e => {
        paperTitleSearchText = e.target.value;
        applyFilters();
      };

      document.addEventListener('click', (e) => {
        if (!e.target.closest('.card')) {
          document.querySelectorAll('.card.expanded').forEach(card => {
            card.classList.remove('expanded');
            updateCardLabels(card, card.item);  
          });
        }
      });

      switchTab('Home Page');
      updateNavPressed();
    });

    window.addEventListener('load', updateContentOffset);
    window.addEventListener('resize', updateContentOffset);

    function updateFilterBarPosition() {
      const headerHeight = document.querySelector('.header-container').offsetHeight;
      const filterBar = document.querySelector('.filter-bar.sticky');
      if (filterBar) {
        filterBar.style.top = `${headerHeight}px`;
        filterBar.style.height = `calc(100vh - ${headerHeight}px)`;
      }
    }

    window.addEventListener('load', updateFilterBarPosition);
    window.addEventListener('resize', updateFilterBarPosition);

    const filterBar = document.querySelector('.filter-bar');
    
    let isHoveringFilterBar = false;
    
    filterBar.addEventListener('mouseenter', () => {
      isHoveringFilterBar = true;
    });
    
    filterBar.addEventListener('mouseleave', () => {
      isHoveringFilterBar = false;
    });
    
    filterBar.addEventListener('wheel', function(e) {
      if (isHoveringFilterBar && this.scrollHeight > this.clientHeight) {
        this.scrollTop += e.deltaY;
        e.preventDefault();
        e.stopPropagation();
      }
    }, { passive: false });

    function sendMail(to) {
      const allEmails = [
        'haonanyao0622@gmail.com',
        'lingyun.yu@xjtlu.edu.cn',
        'lijie.yao@xjtlu.edu.cn'
      ];
      const cc = allEmails.filter(email => email !== to).join(',');
      const subject = encodeURIComponent('[PhysicalVisWidget] Inquiry email');
      const mailto = `mailto:${to}?subject=${subject}&cc=${cc}`;
      window.location.href = mailto;
    }

  </script>
</body>
</html>