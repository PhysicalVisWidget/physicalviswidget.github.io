<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Designing Visualization Widgets for Tangible Data Exploration</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>

  <style>
    /* ===============  Warm Neumorphism Tokens (tuned)  =============== */
    :root {
      /* ---------- Soft Warm Neumorphism Palette ---------- */
      --bg:            #f2f0eb;     /* æ›´æŸ”çš„ç±³ç™½ */
      --elevated:      #ffffff;     /* å¡ç‰‡/æŒ‰é’® */
      --txt-primary:   #3c352e;     /* ç•¥å¾®åæš–çš„æ·±æ£• */
      --txt-secondary: #867c6d;     /* æ¬¡çº§æ–‡å­— */
      --accent:        #d17a5e;     /* é™ä½é¥±å’Œåº¦çš„é™¶åœŸæ©™ */
      --shadow-dark:   rgba(210,200,185,.55); /* æš–ç°æš—å½± (â‰ˆ10% æ›´æ·±) */
      --shadow-light:  #ffffff;     /* é¡¶å·¦é«˜å…‰ */
      --radius-lg:     14px;
      --radius-md:     10px;
      --transition-fast: .2s ease;
    }

    /* ===============  Base / Reset  =============== */
    * { box-sizing: border-box; }
    body {
      font-family: 'JetBrains Mono', monospace;
      background: var(--bg);
      margin: 0;
      padding: 0;
      color: var(--txt-primary);
      overflow-x: hidden;
    }

    a { color: var(--accent); text-decoration: underline; }

    /* ===============  Neumorphism helpers  =============== */
    .neu-flat {
      background: var(--elevated);
      border-radius: var(--radius-md);
      box-shadow: 9px 9px 16px var(--shadow-dark),
                  -9px -9px 16px var(--shadow-light);
      transition: box-shadow var(--transition-fast), transform var(--transition-fast);
    }
    .neu-inset {
      background: var(--elevated);
      border-radius: var(--radius-md);
      box-shadow: inset 6px 6px 10px var(--shadow-dark),
                  inset -6px -6px 10px var(--shadow-light);
    }

    /* raised style for un-selected selects */
    .neu-select-default {
      background: var(--elevated);
      border-radius: var(--radius-md);
      box-shadow: 6px 6px 12px var(--shadow-dark),
                  -6px -6px 12px var(--shadow-light);
    }

    /* äº¤äº’ liftï¼ˆé™æ€å…ƒç´ ç”¨ .static è¦†ç›–ï¼‰ */
    .neu-flat:hover { transform: translateY(-2px); }
    .neu-flat:active {
      box-shadow: inset 6px 6px 12px var(--shadow-dark),
                  inset -6px -6px 12px var(--shadow-light);
      transform: translateY(2px);
    }

    /* è¢«æŒ‰ä¸‹(é€‰ä¸­)çš„æ’å®šæ ·å¼ */
    .pressed {
      box-shadow: inset 6px 6px 12px var(--shadow-dark),
                  inset -6px -6px 12px var(--shadow-light) !important;
      transform: translateY(2px) !important;
    }
    .pressed:hover { transform: translateY(2px) !important; }

    /* é™æ€ surfaceï¼ˆæ—  hover/activeï¼‰*/
    .static { cursor: default; }
    .static.neu-flat:hover,
    .static.neu-flat:active {
      transform: none;
      box-shadow: 9px 9px 16px var(--shadow-dark),
                  -9px -9px 16px var(--shadow-light);
    }

    /* ===============  Header & Navbar  =============== */
    .header-container {
      position: fixed;
      top: 0; left: 0; width: 100%;
      background: var(--bg);
      z-index: 9999;
      padding-bottom: 12px;
      box-shadow: 0 6px 14px rgba(0,0,0,.04);
    }
    .header { text-align: center; padding: 18px 10px 12px; }
    .header h1 { font-size: 1.8rem; font-weight: 700; margin: 0; }
    .authors { font-style: italic; color: var(--txt-secondary); margin: 4px 0 0; }

    /* Navbar */
    .navbar {
      display: flex; justify-content: center; flex-wrap: wrap;
      gap: 12px; margin-top: 14px;
    }
    .navbar button {
      display: flex; align-items: center; gap: 8px;
      padding: 10px 18px; font-size: 1rem; font-weight: bold;
      border: none; color: var(--txt-primary);
      background: var(--elevated); border-radius: var(--radius-lg);
      cursor: pointer;
      box-shadow: 6px 6px 12px var(--shadow-dark),
                  -6px -6px 12px var(--shadow-light);
      transition: var(--transition-fast);
    }
    .icon-placeholder { width: 18px; text-align: center; }

    /* Teaser (é™æ€) */
    .teaser {
      background: var(--elevated);
      border-radius: var(--radius-lg);
      box-shadow: 9px 9px 16px var(--shadow-dark),
                  -9px -9px 16px var(--shadow-light);
      padding: 16px;
      width: 65%;            /* --- requirement #3 --- */
      max-width: 65%;
      height: auto; margin: 0 auto 20px; display: block;
    }

    /* Layout */
    /* top offset handled via JS so no hard-coded padding */
    .content-wrapper {
      width: 100%;
    }
    .layout-outer {
      display: flex; flex-wrap: wrap; justify-content: space-between;
      width: 95%; margin: 0 auto;
    }
    .left-gap, .middle-gap, .right-gap { flex: 1 1 5%; max-width: 5%; }

    /* Result cards */
    .results-table-container { flex: 1 1 65%; display: flex; flex-direction: column; gap: 20px; }
    .card {
      background: var(--elevated);
      border-radius: var(--radius-lg);
      box-shadow: 9px 9px 16px var(--shadow-dark),
                  -9px -9px 16px var(--shadow-light);
      padding: 16px;
      display: flex; align-items: center; gap: 5%;
      height: 8vw; transition: var(--transition-fast);
    }
    .card:hover { transform: translateY(-3px); }

    .card-index { font-size: 1.1rem; font-weight: bold; color: #a39582; margin-right: 10px; flex-shrink: 0; width: 20px; }
    .card img { width: 20%; height: auto; max-height: 100%; object-fit: contain;
                flex-shrink: 0; border-radius: var(--radius-md);
                box-shadow: 3px 3px 6px var(--shadow-dark),
                            -3px -3px 6px var(--shadow-light); }
    .card-content {
      width: 75%;
    }

    .card-text {
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 4; /* æ§åˆ¶æ ‡é¢˜å’Œä½œè€…æ˜¾ç¤ºè¡Œæ•° */
      -webkit-box-orient: vertical;
      text-overflow: ellipsis;
    }

    .results-table-container.exploration-active .card.expanded .card-text {
      overflow: visible;
      display: block;
      -webkit-line-clamp: none;
    }
    .card-title   { font-weight: 700; font-size: 1rem; margin-bottom: 6px; text-decoration: underline; }
    .card-authors { font-size: 0.85rem; color: var(--txt-secondary); margin-bottom: 6px; }

    /* Exploration mode image styles */
    /* Exploration mode image styles */
    .results-table-container.exploration-active .card img {
      border-radius: 0;
      box-shadow: none;
      background: transparent;
    }

    /* æ·»åŠ æ¢ç´¢æ¨¡å¼ä¸‹å¡ç‰‡å›ºå®šé«˜åº¦å’Œæ–‡æœ¬æº¢å‡ºå¤„ç† */
    .results-table-container.exploration-active .card {
      height: 150px; /* å›ºå®šå¡ç‰‡é«˜åº¦ */
      transition: height 0.3s ease;
    }

    .results-table-container.exploration-active .card.expanded {
      height: auto; /* è‡ªé€‚åº”é«˜åº¦ä»¥æ˜¾ç¤ºå®Œæ•´å†…å®¹ */
    }

    .results-table-container.exploration-active .card.expanded .card-content {
      overflow: visible;
      display: block;
      -webkit-line-clamp: none;
    }

    .card-icons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    /* å±•å¼€çŠ¶æ€ä¸‹çš„å›¾æ ‡å¸ƒå±€ - ä¸€è¡Œ3ä¸ª */
    .results-table-container.exploration-active .card.expanded .card-icons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .card-icon {
      width: 30px;
      height: 30px;
      background-color: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: var(--txt-secondary);
      box-shadow: inset 2px 2px 4px var(--shadow-dark),
                  inset -2px -2px 4px var(--shadow-light);
      border-radius: 4px;
    }
    .card-content {
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 4; /* æ˜¾ç¤ºå¤šå°‘è¡Œåæˆªæ–­ */
      -webkit-box-orient: vertical;
      text-overflow: ellipsis;
    }

    /* Filter sidebar */
    .filter-bar {
      flex: 1 1 20%; background: var(--elevated);
      border-radius: var(--radius-lg);
      padding: 22px;
      box-shadow: 9px 9px 16px var(--shadow-dark),
                  -9px -9px 16px var(--shadow-light);
      height: fit-content; min-width: 200px;
    }

    /* æ·»åŠ ç­›é€‰æ æ‚¬æµ®æ ·å¼ */
    .filter-bar.sticky {
      position: sticky;
      overflow-y: auto;
      /* ä½ç½®å’Œé«˜åº¦å°†é€šè¿‡JSåŠ¨æ€è®¾ç½® */
      /* æ·»åŠ æ»šåŠ¨æ¡æ ·å¼ä¼˜åŒ– */
      scrollbar-width: thin;
      scrollbar-color: var(--txt-secondary) transparent;
    }

    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
    .filter-bar.sticky::-webkit-scrollbar {
      width: 6px;
    }

    .filter-bar.sticky::-webkit-scrollbar-thumb {
      background-color: var(--txt-secondary);
      border-radius: 3px;
    }
    .filter-bar h3 { margin-top: 0; text-align:center; }

    .filter-section { margin-bottom: 26px; padding-bottom: 16px; border-bottom: 1px solid #e8e3dc; }
    .filter-section h4 { margin: 0 0 14px; font-weight: bold; }

    .filter-item { display:flex; flex-direction:column; margin-bottom: 14px; }
    .filter-item label { font-size: .9rem; margin-bottom: 4px; }

    .title-reset-container { display: flex; align-items: center; gap: 8px; }

    .filter-select,
    .paper-title-input {
      width: 100%; padding: 8px 10px;
      font-family: 'JetBrains Mono', monospace; border: none;
      background: var(--elevated); border-radius: var(--radius-md);
      box-shadow: inset 4px 4px 8px var(--shadow-dark),
                  inset -4px -4px 8px var(--shadow-light);
      appearance: none; outline: none;
    }
    .filter-select:focus,
    .paper-title-input:focus {
      box-shadow: inset 2px 2px 6px var(--shadow-dark),
                  inset -2px -2px 6px var(--shadow-light);
    }

    .reset-btn {
      padding: 8px 14px; font-weight: bold; border: none;
      color: var(--txt-primary); background: var(--elevated);
      border-radius: var(--radius-md); cursor: pointer;
      box-shadow: 6px 6px 12px var(--shadow-dark),
                  -6px -6px 12px var(--shadow-light);
      transition: var(--transition-fast);
    }
    .reset-btn:hover  { transform: translateY(-2px); }
    .reset-btn:active {
      box-shadow: inset 4px 4px 8px var(--shadow-dark),
                  inset -4px 4px 8px var(--shadow-light);
      transform: translateY(2px);
    }

    /* Home-page text */
    .text-content {
      width: 80%; margin: 0 auto;
      font-size: 0.95rem; line-height: 1.6; text-align: justify;
      background: var(--elevated); border-radius: var(--radius-lg);
      padding: 10px 10px;
      box-shadow: 9px 9px 16px var(--shadow-dark),
                  -9px -9px 16px var(--shadow-light);
    }

    /* Responsive */
    @media screen and (max-width: 800px) {
      .layout-outer { flex-direction: column; align-items: center; }
      .left-gap, .middle-gap, .right-gap { display: none; }
      .results-table-container, .filter-bar { width: 90% !important; }
      .text-content { width: 90%; }
    }
  </style>
</head>

<body>
  <!-- =============== HEADER =============== -->
  <div class="header-container">
    <div class="header">
      <h1>Designing Visualization Widgets for Tangible Data Exploration:</h1>
      <h1>A Systematic Review</h1>
      <p class="authors">Haonan Yao, Lingyun Yu, Lijie Yao</p>
    </div>

    <img src="Resources/Teaser.jpg" class="teaser neu-flat static" alt="Teaser">

    <div class="navbar">
      <!-- data-tab ç”¨äºæœ¬åœ°åˆ‡æ¢ï¼›data-link å¤–é“¾æŒ‰é’® -->
      <button class="neu-flat" data-tab="home"><span class="icon-placeholder">ğŸ </span>Home Page</button>
      <button class="neu-flat" data-tab="explore"><span class="icon-placeholder">ğŸ”­</span>Exploration</button>
      <button class="neu-flat" data-link="https://example.com/paper"  ><span class="icon-placeholder">ğŸ“„</span>Paper</button>
      <button class="neu-flat" data-link="https://osf.io/vjw5e/"       ><span class="icon-placeholder">ğŸ“</span>OSF</button>
      <button class="neu-flat" data-link="mailto:haonanyao0622@gmail.com"><span class="icon-placeholder">ğŸ“§</span>Contact</button>
    </div>
  </div>

  <!-- =============== MAIN CONTENT =============== -->
  <div class="content-wrapper">
    <!-- Exploration -->
    <div class="layout-outer" id="exploreSection">
      <div class="left-gap"></div>

      <div class="results-table-container" id="resultsContainer">
        <p>Loading...</p>
      </div>

      <div class="middle-gap"></div>

      <div class="filter-bar neu-flat static">
        <h3>Filter</h3>

        <div class="instance-count-container">
          <p>Number of instances:</p>
          <span id="instanceCount">0 / 0</span>
        </div>

        <div class="filter-section">
          <br>
          <h4>Search:</h4>
          <div class="title-reset-container">
            <input type="text" id="paperTitleSearch" placeholder="Search by keywords..." class="paper-title-input neu-inset">
            <button id="resetFilters" class="reset-btn">Reset</button>
          </div>
        </div>

        <div id="filterOptions"></div>
      </div>

      <div class="right-gap"></div>
    </div>

    <!-- Home Page -->
    <div id="textSection" style="display:none">
      <div class="text-content">
        <h3 class="card-title" style="font-size: 1rem; font-weight: bold; color: var(--txt-primary); margin-top: 0; text-decoration: none; font-family: Arial">Abstract</h3>
        <p>
          We present a systematic review on tasks, interactions, and visualization widgets in the context of tangible data exploration.
          Tangible widgets have been shown to reduce cognitive load, enable more natural interactions, and support the completion of complex data exploration tasks.
          Yet, the field lacks a structured understanding of how task types, interaction methods, and widget designs are coordinated, limiting the ability to identify recurring design patterns and opportunities for innovation.
          To address this gap, we conduct a systematic review to analyze existing work and characterize the current design of data exploration tasks, interactions, and tangible visualization widgets.
          We next reflect based on our findings and propose a research agenda to inform the development of a future widget design toolkit for tangible data exploration.
          Our systematic review and supplemental materials are available at <a href="https://osf.io/vjw5e/">osf.io/vjw5e/</a>.
        </p>
      </div>

      <div class="text-content" style="margin-top: 20px">
        <h3 class="card-title" style="font-size: 1rem; font-weight: bold; color: var(--txt-primary); margin-top: 0; text-decoration: none; font-family: Arial">Categorization</h3>
        <p>
          <img src="Resources/Icons/TaskEntity.jpg" style="width:24px; height:24px; margin-right:8px; vertical-align:middle;"><strong style="color: rgb(80,79,114);">Tasks</strong> describe in which environment the data exploration tasks have been conducted (<em>Task environment</em>), what the task content is (<em>Task content</em>), and in which representation the task entity has been perceived by users (<em>Task entity's representation</em>).<br>
          <img src="Resources/Icons/UserInteraction.jpg" style="width:24px; height:24px; margin-right:8px; vertical-align:middle;"><strong style="color: rgb(82,106,96);">User Interactions</strong> describe how users operate tangible entities to complete a data exploration task (<em>Manipulation method</em>), what interactions users perform (<em>Interaction type</em>), and where interactions take place (<em>Where the interaction happens</em>).<br>
          <img src="Resources/Icons/Widgets.jpg" style="width:24px; height:24px; margin-right:8px; vertical-align:middle;"><strong style="color: rgb(140,95,35);">Visualization Widgets</strong> refer to tangible entities that are used to accomplish data exploration tasks through specific interactions. Here we discuss how big a widget is (<em>Size</em>), how many widgets are used (<em>Quantity</em>), the shape in which the widget acts (<em>Functional shape</em>), and the material properties of the widget (<em>Material properties</em>).<br>
          <img src="Resources/Icons/RelativePosition.jpg" style="width:24px; height:24px; margin-right:8px; vertical-align:middle;"><strong style="color: rgb(156,75,75);">Relative Position</strong> indicates the <em>Accessible distance between user and task entity</em>, the <em>Accessible distance between user and visualization widget(s)</em>, and the <em>Spatial integration between task entity and visualization widget(s)</em>.
        </p>
      </div>
    </div>
  </div>

  <!-- =============== SCRIPTS =============== -->
  <script>
    /* ---------- Dataset & Filters ---------- */
    let allData = [];
    let currentFilters = {};
    let paperTitleSearchText = '';
    let currentTab = 'Home Page';    // å½“å‰é¡µé¢

    const groups = [
      { title: 'Tasks', labels: ['Task Environment', 'Task Content', "Task Entity's Representation"] },
      { title: 'User Interactions', labels: ['Manipulation Method', 'Interaction Type', 'Where the Interaction Happens'] },
      { title: 'Visualization Widgets', labels: ['Size', 'Quantity', 'Physical Form', 'Functional Shape', 'Material Properties'] },
      { title: 'Relative Position', labels: ['Accessible Distance between User and Visualization Widget(s)', 'Accessible Distance between User and Task Entity', 'Spatial Integration between Task Entity and Visualization Widget(s)'] }
    ];

    /* ------- é€šç”¨è¾…åŠ©ï¼šå·¦é”® / ä¸­é”®ç»Ÿä¸€è§¦å‘ ------- */
    function addUnifiedClick(el, handler) {
      // å·¦é”® click
      el.addEventListener('click',  e => handler(e, /*isMiddle=*/false));

      // ä¸­é”® (éƒ¨åˆ†æµè§ˆå™¨åªè§¦å‘ auxclickï¼Œéƒ¨åˆ†åªè§¦å‘ mousedown)  
      el.addEventListener('auxclick', e => {
        if (e.button === 1) {
          e.preventDefault();
          handler(e, /*isMiddle=*/true);
        }
      });
      el.addEventListener('mousedown', e => {
        if (e.button === 1) {
          e.preventDefault();
          handler(e, /*isMiddle=*/true);
        }
      });
    }

    /* ------- å¯¼èˆªæŒ‰é’®â€œè¢«æŒ‰ä¸‹â€æ ·å¼åŒæ­¥ ------- */
    const navButtons = document.querySelectorAll('.navbar button');

    function updateNavPressed() {
      navButtons.forEach(btn => {
        const tab = btn.dataset.tab;
        if ((tab === 'home' && currentTab === 'Home Page') ||
            (tab === 'explore' && currentTab === 'Exploration')) {
          btn.classList.add('pressed');
        } else {
          btn.classList.remove('pressed');
        }
      });
    }

    /* åˆå§‹åŒ–æŒ‰é’®äº¤äº’ç›‘å¬ */
    navButtons.forEach(btn => {
      // hover æŒ‰å‹åŠ¨ç”»
      btn.addEventListener('mousedown', () => {
        navButtons.forEach(b => b.classList.remove('pressed'));
        btn.classList.add('pressed');
      });
      btn.addEventListener('mouseup',   updateNavPressed);
      btn.addEventListener('mouseleave',updateNavPressed);

      // å·¦é”® + ä¸­é”®ç»Ÿä¸€å¯¼èˆª
      addUnifiedClick(btn, (e) => {
        if (btn.dataset.tab) {
          currentTab = (btn.dataset.tab === 'home') ? 'Home Page' : 'Exploration';
          switchTab(currentTab);
          updateNavPressed();
        } else if (btn.dataset.link) {
          // å¤–é“¾ï¼šå§‹ç»ˆåœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€
          window.open(btn.dataset.link, '_blank');
        }
      });
    });

    /* middle/left-click support for Reset button */
    addUnifiedClick(document.getElementById('resetFilters'), () => resetAllFilters());

    /* ------- é¡µé¢åˆ‡æ¢ ------- */
    function switchTab(tabName) {
        const explore = document.getElementById('exploreSection');
        const text    = document.getElementById('textSection');
        const filterBar = document.querySelector('.filter-bar');
        const resultsContainer = document.querySelector('.results-table-container');
        
        if (tabName === 'Home Page') {
            explore.style.display = 'none';
            text.style.display    = 'block';
            filterBar.classList.remove('sticky');
            resultsContainer.classList.remove('exploration-active');
        } else {
            explore.style.display = 'flex';
            text.style.display    = 'none';
            // åˆ‡æ¢åˆ°æ¢ç´¢é¡µé¢æ—¶æ›´æ–°æ‰€æœ‰ç­›é€‰é€‰é¡¹æ¡†æ ·å¼
            document.querySelectorAll('.filter-select').forEach(select => {
                toggleSelectStyle(select);
            });
            filterBar.classList.add('sticky');
            updateFilterBarPosition(); // æ›´æ–°ç­›é€‰æ ä½ç½®
            resultsContainer.classList.add('exploration-active');
        }
        updateContentOffset(); // æ·»åŠ æ­¤è¡Œä»¥é‡æ–°è®¡ç®—å†…å®¹åç§»é‡
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    /* ------- Filter UI æ„å»º & æ•°æ®æ¸²æŸ“ ------- */
    function createFilterOptions() {
      const container = document.getElementById('filterOptions');
      container.innerHTML = '';
      groups.forEach(group => {
        const sec = document.createElement('div');
        sec.className = 'filter-section';
    
        const title = document.createElement('h4');
        // æ·»åŠ å›¾æ ‡å’Œé¢œè‰²
        const icon = document.createElement('img');
        switch(group.title) {
          case 'Tasks':
            icon.src = 'Resources/Icons/TaskEntity.jpg';
            title.style.color = 'rgb(80,79,114)';
            break;
          case 'User Interactions':
            icon.src = 'Resources/Icons/UserInteraction.jpg';
            title.style.color = 'rgb(82,106,96)';
            break;
          case 'Visualization Widgets':
            icon.src = 'Resources/Icons/Widgets.jpg';
            title.style.color = 'rgb(140,95,35)';
            break;
          case 'Relative Position':
            icon.src = 'Resources/Icons/RelativePosition.jpg';
            title.style.color = 'rgb(156,75,75)';
            break;
        }
        icon.style.width = '24px';
        icon.style.height = '24px';
        icon.style.marginRight = '8px';
        icon.style.verticalAlign = 'middle';
        title.appendChild(icon);
        title.appendChild(document.createTextNode(group.title));
        sec.appendChild(title);

        group.labels.forEach(label => {
          // ç»Ÿè®¡ç­›é€‰åçš„æ•°é‡
          const allValues   = [...new Set(allData.map(d => d[label]))].filter(Boolean).sort();
          const filtered    = applyCurrentFilterExcept(label);
          const counts      = Object.fromEntries(allValues.map(v => [v, 0]));
          filtered.forEach(d => { const v = d[label]; if (v) counts[v]++; });

          // UI å®¹å™¨
          const item = document.createElement('div');
          item.className = 'filter-item';

          const lab = document.createElement('label');
          lab.textContent = label + ':';
          item.appendChild(lab);

          const select = document.createElement('select');
          select.className = 'filter-select';
          select.dataset.label = label;
          select.innerHTML = '<option value="">All</option>';
          allValues.forEach(v => {
            select.innerHTML += `<option value="${v}">${v} (${counts[v] || 0})</option>`;
          });

          // å½“å‰çŠ¶æ€
          select.value = currentFilters[label] || '';
          toggleSelectStyle(select);

          addUnifiedClick(select, () =>{/*no-op: select handles change*/});
          select.onchange = e => {
            currentFilters[label] = e.target.value;
            toggleSelectStyle(e.target);
            applyFilters();
          };

          item.appendChild(select);
          sec.appendChild(item);
        });
        container.appendChild(sec);
      });
    }

    // å¤„äºé»˜è®¤â€œAllâ€æ—¶ä½¿ç”¨ raised æ ·å¼
    function toggleSelectStyle(sel) {
      if (sel.value === '') {
        // ç§»é™¤æŒ‰ä¸‹æ ·å¼ï¼Œæ·»åŠ å¼¹èµ·æ ·å¼
        sel.classList.remove('neu-inset');
        sel.classList.add('neu-select-default');
        // å¼ºåˆ¶åº”ç”¨å¼¹èµ·çŠ¶æ€çš„é˜´å½±æ ·å¼
        sel.style.boxShadow = '6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light)';
      } else {
        // ç§»é™¤å¼¹èµ·æ ·å¼ï¼Œæ·»åŠ æŒ‰ä¸‹æ ·å¼
        sel.classList.add('neu-inset');
        sel.classList.remove('neu-select-default');
        // æ¢å¤æŒ‰ä¸‹çŠ¶æ€çš„é˜´å½±æ ·å¼
        sel.style.boxShadow = 'inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light)';
      }
    }

    const applyCurrentFilterExcept = skip =>
      allData.filter(d =>
        Object.entries(currentFilters).every(([k, v]) => k === skip || !v || d[k] === v) &&
        (!paperTitleSearchText || matchesSearchText(d))
      );

    const matchesSearchText = d => {
      const allLabels = ['Paper Name', 'Authors'].concat(...groups.map(g => g.labels));
      return allLabels.some(l => d[l] && d[l].toLowerCase().includes(paperTitleSearchText.toLowerCase()));
    };

    function applyFilters() {
      const filtered = allData.filter(d =>
        Object.entries(currentFilters).every(([k, v]) => !v || d[k] === v) &&
        (!paperTitleSearchText || matchesSearchText(d))
      );
      renderResults(filtered);
      createFilterOptions();
    }

    function renderResults(data) {
      const container = document.getElementById('resultsContainer');
      container.innerHTML = '';
      document.getElementById('instanceCount').textContent = `${data.length} / ${allData.length}`;
    
      if (!data.length) { container.innerHTML = '<p>No results found.</p>'; return; }
    
      data.forEach((item, idx) => {
        const card = document.createElement('div'); 
        card.className = 'card';
        // æ·»åŠ ç‚¹å‡»å±•å¼€åŠŸèƒ½ - å…³é—­å…¶ä»–æ‰€æœ‰å¡ç‰‡
        addUnifiedClick(card, () => {
        // ç§»é™¤æ‰€æœ‰å¡ç‰‡çš„å±•å¼€çŠ¶æ€
        document.querySelectorAll('.card').forEach(c => {
        c.classList.remove('expanded');
        });
        // åˆ‡æ¢å½“å‰å¡ç‰‡çš„å±•å¼€çŠ¶æ€
        card.classList.toggle('expanded');
        });
    
        const index = document.createElement('div'); 
        index.className = 'card-index'; 
        index.textContent = idx + 1;
        card.appendChild(index);
    
        const img = document.createElement('img');
        img.src = `Resources/PaperImages/Instance${item.originalIndex + 1}.png`;
        img.alt = 'Figure';
        card.appendChild(img);
    
        const content = document.createElement('div'); 
        content.className = 'card-content';
        content.innerHTML = `
          <div class="card-text">
            <a class="card-title" href="${item['Paper Link'] || '#'}" target="_blank">${item['Paper Name'] || ''}</a>
            <div class="card-authors">${item['Authors'] || ''}</div>
          </div>
          <div class="card-icons"></div>`;
        card.appendChild(content);
    
        // é˜»æ­¢æ ‡é¢˜é“¾æ¥çš„äº‹ä»¶å†’æ³¡
        const titleLink = content.querySelector('.card-title');
        titleLink.addEventListener('click', (e) => {
          e.stopPropagation();
        });
    
        // æ·»åŠ 14ä¸ªç¤ºä¾‹å›¾æ ‡
        const iconsContainer = content.querySelector('.card-icons');
        for (let i = 1; i <= 14; i++) {
          const icon = document.createElement('div');
          icon.className = 'card-icon';
          icon.textContent = `ex${i}`;
          iconsContainer.appendChild(icon);
        }
    
        container.appendChild(card);
      });
    }

    async function loadCSVData() {
      const resp  = await fetch('Resources/metadata.csv');
      // ä½¿ç”¨arrayBufferæ›¿ä»£text()ä»¥æ˜¾å¼æ§åˆ¶ç¼–ç 
      const buffer = await resp.arrayBuffer();
      const decoder = new TextDecoder('utf-8');
      let text = decoder.decode(buffer);
      // ç§»é™¤å¯èƒ½å­˜åœ¨çš„UTF-8 BOMå¤´
      text = text.replace(/^\ufeff/, '');
      const data  = d3.csvParse(text);
      data.forEach((d, i) => d.originalIndex = i);
      allData = data;
      createFilterOptions();
      renderResults(allData);
    }

    /* ------- é‡ç½® ------- */
    function resetAllFilters() {
      currentFilters = {};
      paperTitleSearchText = '';
      document.getElementById('paperTitleSearch').value = '';
      renderResults(allData);
      createFilterOptions();
    }

    /* ------- åŠ¨æ€è®¡ç®—å†…å®¹é¡¶è· (æ»¡è¶³éœ€æ±‚ #4) ------- */
    function updateContentOffset() {
      const header = document.querySelector('.header-container');
      const contentWrapper = document.querySelector('.content-wrapper');
      if (header && contentWrapper) {
        const offset = header.offsetHeight + 20; // 20px ä½™é‡
        contentWrapper.style.marginTop = offset + 'px';
      }
    }

    /* ------- åˆå§‹åŒ– ------- */
    document.addEventListener('DOMContentLoaded', () => {
      loadCSVData();

      // æœç´¢è¾“å…¥
      document.getElementById('paperTitleSearch').oninput = e => {
        paperTitleSearchText = e.target.value;
        applyFilters();
      };

      // ç‚¹å‡»ç©ºç™½å¤„å…³é—­æ‰€æœ‰å±•å¼€çš„å¡ç‰‡
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.card')) {
          document.querySelectorAll('.card.expanded').forEach(card => {
            card.classList.remove('expanded');
          });
        }
      });

      // é»˜è®¤ Home Page
      switchTab('Home Page');
      updateNavPressed();
    });

    // åœ¨æ‰€æœ‰èµ„æºåŠ è½½å®Œ & çª—å£å°ºå¯¸å˜åŒ–æ—¶æ›´æ–°é¡¶è·
    window.addEventListener('load', updateContentOffset);
    window.addEventListener('resize', updateContentOffset);

    // æ·»åŠ ç­›é€‰æ ä½ç½®æ›´æ–°å‡½æ•°
    function updateFilterBarPosition() {
      const headerHeight = document.querySelector('.header-container').offsetHeight;
      const filterBar = document.querySelector('.filter-bar.sticky');
      if (filterBar) {
        filterBar.style.top = `${headerHeight}px`;
        filterBar.style.height = `calc(100vh - ${headerHeight}px)`;
      }
    }

    // é¡µé¢åŠ è½½å’Œçª—å£è°ƒæ•´æ—¶æ›´æ–°ç­›é€‰æ ä½ç½®
    window.addEventListener('load', updateFilterBarPosition);
    window.addEventListener('resize', updateFilterBarPosition);

    // æ·»åŠ ç­›é€‰æ ç‹¬ç«‹æ»šåŠ¨åŠŸèƒ½
    const filterBar = document.querySelector('.filter-bar');
    
    // è·Ÿè¸ªé¼ æ ‡æ˜¯å¦æ‚¬åœåœ¨ç­›é€‰æ ä¸Š
    let isHoveringFilterBar = false;
    
    filterBar.addEventListener('mouseenter', () => {
      isHoveringFilterBar = true;
    });
    
    filterBar.addEventListener('mouseleave', () => {
      isHoveringFilterBar = false;
    });
    
    filterBar.addEventListener('wheel', function(e) {
      // åªæœ‰å½“é¼ æ ‡æ‚¬åœä¸”å†…å®¹è¶…å‡ºå®¹å™¨é«˜åº¦æ—¶æ‰å¤„ç†æ»šåŠ¨
      if (isHoveringFilterBar && this.scrollHeight > this.clientHeight) {
        // å…è®¸ç­›é€‰æ æ»šåŠ¨
        this.scrollTop += e.deltaY;
        // é˜»æ­¢äº‹ä»¶å†’æ³¡åˆ°é¡µé¢
        e.preventDefault();
        e.stopPropagation();
      }
    }, { passive: false });
  </script>
</body>
</html>